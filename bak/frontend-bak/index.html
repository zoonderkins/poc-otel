<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Frontend App with Faro Monitoring</title>
  
  <style>
    .container { margin: 20px; }
    .form-group { margin: 10px 0; }
    #status { margin-top: 20px; padding: 10px; background: #f0f0f0; }
    .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
    .product-card { border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
    .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .nav-tab { padding: 10px; cursor: pointer; border: 1px solid #ddd; }
    .nav-tab.active { background: #007bff; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>


<script>
  (function() {
    // Create a promise to track Faro initialization
    window.faroReady = new Promise((resolve) => {
      var webSdkScript = document.createElement("script");
      webSdkScript.src = "https://unpkg.com/@grafana/faro-web-sdk@1.11.0/dist/bundle/faro-web-sdk.iife.js";

      webSdkScript.onload = () => {
        window.faro = window.GrafanaFaroWebSdk.initializeFaro({
          url: '/collect',
          apiKey: 'asdf',
          app: {
            name: 'frontend',
            version: '1.1.0',
            environment: 'development'
          },
          instrumentations: [
            ...window.GrafanaFaroWebSdk.getWebInstrumentations(),
          ],
          transports: [
            new window.GrafanaFaroWebSdk.ConsoleTransport(),
            new window.GrafanaFaroWebSdk.FetchTransport({
              url: '/collect',
              apiKey: 'asdf',
              headers: {
                'Content-Type': 'application/vnd.faro.telemetry+json',
                'Accept': 'application/json'
              }
            })
          ],
          meta: {
            browser: {
              locale: navigator.language,
              userAgent: navigator.userAgent,
            }
          }
        });

        // Load tracing bundle
        var webTracingScript = document.createElement("script");
        webTracingScript.src = "https://unpkg.com/@grafana/faro-web-tracing@1.11.0/dist/bundle/faro-web-tracing.iife.js";

        webTracingScript.onload = () => {
          window.faro.instrumentations.add(
            new window.GrafanaFaroWebTracing.TracingInstrumentation({
              instrumentationOptions: {
                propagateTraceHeaderCorsUrls: [/.*/],
              },
            })
          );
          // Resolve the promise when everything is ready
          resolve(window.faro);
        };
        document.head.appendChild(webTracingScript);
      };

      document.head.appendChild(webSdkScript);
    });
  })();
</script>

</head>
<body>


  <script>
    (function() {
    var elasticApm = document.createElement('script');
    elasticApm.src = "https://unpkg.com/@elastic/apm-rum@5.16.0/dist/bundles/elastic-apm-rum.umd.min.js";
    elasticApm.onload = () => {
      elasticApm.init({
      serviceName: 'otel-frontend',
      serverUrl: 'http://localhost:8200',
      environment: 'development',
      })
    }
      document.head.appendChild(elasticApm);
    })();
  </script>

  <div class="container">
    <h1>Shopping App with Monitoring</h1>

    <!-- Login Form -->
    <div id="loginSection" class="form-group">
      <h2>Login</h2>
      <form id="loginForm">
        <div>
          <label for="loginUsername">Username:</label>
          <input type="text" id="loginUsername" name="username" value="admin" required>
        </div>
        <div>
          <label for="loginPassword">Password:</label>
          <input type="password" id="loginPassword" name="password" value="admin" required>
        </div>
        <button type="submit">Login</button>
      </form>
    </div>

    <!-- Main Content (hidden until logged in) -->
    <div id="mainContent" style="display: none;">
      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <div class="nav-tab active" data-tab="products">Products</div>
        <div class="nav-tab" data-tab="cart">Cart</div>
        <div class="nav-tab" data-tab="orders">Orders</div>
      </div>

      <!-- Products Tab -->
      <div id="productsTab" class="tab-content active">
        <h2>Available Products</h2>
        <div id="productList" class="product-list">
          <!-- Products will be loaded here -->
        </div>
      </div>

      <!-- Cart Tab -->
      <div id="cartTab" class="tab-content">
        <h2>Shopping Cart</h2>
        <div id="cartItems">
          <!-- Cart items will be loaded here -->
        </div>
        <div id="cartTotal">Total: $0.00</div>
        <button id="checkoutButton">Proceed to Checkout</button>
      </div>

      <!-- Orders Tab -->
      <div id="ordersTab" class="tab-content">
        <h2>Your Orders</h2>
        <div id="orderList">
          <!-- Orders will be loaded here -->
        </div>
      </div>
    </div>

    <div id="status"></div>
  </div>

  <!-- Templates -->
  <template id="productTemplate">
    <div class="product-card">
      <h3 class="product-name"></h3>
      <p class="product-description"></p>
      <p class="product-price"></p>
      <button class="add-to-cart">Add to Cart</button>
    </div>
  </template>

  <template id="cartItemTemplate">
    <div class="cart-item">
      <span class="item-name"></span>
      <span class="item-quantity">
        <button class="decrease-quantity">-</button>
        <span class="quantity-value"></span>
        <button class="increase-quantity">+</button>
      </span>
      <span class="item-price"></span>
      <button class="remove-item">Remove</button>
    </div>
  </template>

  <template id="orderTemplate">
    <div class="order-item">
      <h4>Order #<span class="order-id"></span></h4>
      <p>Date: <span class="order-date"></span></p>
      <p>Total: <span class="order-total"></span></p>
      <div class="order-items">
        <!-- Order items will be listed here -->
      </div>
    </div>
  </template>

  <!-- OpenTelemetry Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@opentelemetry/api@1.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@opentelemetry/sdk-trace-web@1.9.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@opentelemetry/exporter-trace-otlp-http@0.39.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@opentelemetry/resources@1.9.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@opentelemetry/semantic-conventions@1.9.1"></script>
  <script>
    // Wait for the scripts to load
    window.addEventListener('load', () => {
      const provider = new OpenTelemetryWeb.WebTracerProvider({
        resource: new OpenTelemetryWeb.Resource({
          'service.name': 'frontend-service',
          'deployment.environment': 'development'
        })
      });
      
      const exporter = new OpenTelemetryTraceOtlpHttp.OTLPTraceExporter({
        url: 'http://localhost:4318/v1/traces'
      });
      
      provider.addSpanProcessor(new OpenTelemetryWeb.SimpleSpanProcessor(exporter));
      provider.register();
      
      // Make tracer available globally
      window.tracer = provider.getTracer('frontend-tracer');
      
      console.log('OpenTelemetry initialized successfully');
    });
  </script>
  <script type="module" src="/script.js"></script>
</body>
</html>